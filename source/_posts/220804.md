---
title: DBへの入口に到達
date: 2022-08-04 21:09:38
categories: PHP
tags: 
- DB
- INSERT
- UPDATE
- DELETE
---

一気につかまえたい。
五日目。

{% asset_img 220110_1156190.jpg %}

PHPを使って、DB接続をする。
最初、教則本どおりやってもエラーが出る。
多分、情報が古いのかもしれない。
エラーの番号で検索を2回ほどくりかえして見事突破する。
今は、独学するには最高の環境なのかもしれない。

### 今日の注目点

* SQLの文章をかませる必要がある。SQLの文法には要注意する。

**まずはDBへの接続**
```
<?php
$dsn = "mysql:dbname=sample;host=localhost;charset=utf8";
$user = "root";
$password = "root";  // <= パスワードをダブルクォーテーションで括ること。

try {
    $dbh = new PDO($dsn, $user, $password);
    $dbh -> setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
    echo '接続に成功しました。';
} catch(PDOException $e) {
    print("接続に失敗しました。".$e -> getMessage());
    die();
}
```

**DBへSQL文をそのまま書いて値の追加**
```
<?php
try {
  $dbh = new PDO($dsn, $user, $password);
  $dbh->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
  $sql = "INSERT INTO `user`(`id`, `name`, `age`, `email`) VALUES (NULL, '高広　信之', '57', 'taka@nobu.com')";
  // ↑ phpMyAdminのSQLの操作画面に出てくるサンプルをたよりにして書いたら見事1発で通る。
  $stmt = $dbh->prepare($sql);
  $stmt->bindValue(':name', $name, PDO::PARAM_STR);
  $stmt->bindValue(':age', $age, PDO::PARAM_INT);
  $stmt->bindValue(':email', $age, PDO::PARAM_STR);
  $stmt->execute();
  echo 'データを追加しました。';
} catch (PDOException $e) {
  print("接続に失敗しました。".$e->getMessage());
  die();
}
```

**DBへ変数を使って値の追加**
```
<?php
$name = "王　貞治";
$age = 77;

try {
  $dbh = new PDO($dsn, $user, $password);
  $dbh->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
  $sql = "INSERT INTO `user`(`name`, `age`) VALUES (:name, :age)";
  $stmt = $dbh->prepare($sql);
  $stmt->bindValue(':name', $name, PDO::PARAM_STR);
  $stmt->bindValue(':age', $age, PDO::PARAM_INT);
  $stmt->execute();
  echo "{$name}さんのデータを追加しました。";
} catch (PDOException $e) {
  print("接続に失敗しました。".$e->getMessage());
  die();
}
```

**DBへ値の変更**
```
<?php
$dsn = "mysql:dbname=sample;host=localhost;charset=utf8";
$user = "root";
$password = "root";
$email = "hogehoga@kazue.com";

try {
  $dbh = new PDO($dsn, $user, $password);
  $dbh->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
  $sql = "UPDATE `user` SET `email` = :email WHERE id = 2";
  $stmt = $dbh->prepare($sql);
  $stmt->bindValue(':email', $email, PDO::PARAM_STR);
  $stmt->execute();
  echo '処理が終了しました。';
} catch (PDOException $e) {
  print("接続に失敗しました。".$e->getMessage());
  die();
}
```

**そして削除**
```
<?php
try {
  $dbh = new PDO($dsn, $user, $password);
  $dbh->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);
  $sql = "DELETE FROM `user` WHERE id = 10";
  $stmt = $dbh->prepare($sql);
  $stmt->execute();
  echo '処理が終了しました。';
} catch (PDOException $e) {
  print("接続に失敗しました。".$e->getMessage());
  die();
}
```